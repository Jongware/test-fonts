<!DOCTYPE html>
<html lang="en-us">

  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      EvenOddTT &middot; Test fonts
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/test-fonts/public/css/poole.css">
  <link rel="stylesheet" href="/test-fonts/public/css/syntax.css">
  <link rel="stylesheet" href="/test-fonts/public/css/lanyon.css">
  <link rel="stylesheet" href="/test-fonts/public/css/twardoch.css">
  <link rel="stylesheet" href="/test-fonts/public/css/breadcrumb.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/test-fonts/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/test-fonts/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>


  <body class="sidebar-overlay layout-reverse">

    <!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
     styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox" >

<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <p>A small collection of test fonts (OpenType and Multiple Master) for testing implementations of font formats. Please see subfolders for more info and licenses.</p>
  </div>

  <nav class="sidebar-nav">
    <!-- 
    <a class="sidebar-nav-item" href="/test-fonts/">test-fonts</a>
    -->

    

    
    
      
        
      
    
      
    
      
        
          <a class="sidebar-nav-item" href="/test-fonts/gx/index.html">Variable OpenType test fonts</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/test-fonts/nadyezhdaslone/index.html">Nadyezhda SL One</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/test-fonts/otetest/index.html">OTETest</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/test-fonts/smpcurmm/index.html">SmpCurMM</a>
        
      
    
      
        
          <a class="sidebar-nav-item" href="/test-fonts/totopfr/index.html">totopfr</a>
        
      
    
      
        
          <a class="sidebar-nav-item active" href="/test-fonts/varia/160413-EvenOddTT/index.html">EvenOddTT</a>
        
      
    

    <a class="sidebar-nav-item" href="">GitHub repo</a>
    <!-- 
    <span class="sidebar-nav-item">Currently v1.0.0</span>
    -->
  </nav>

  <div class="sidebar-item">
    <p>
      &copy; 2017 <a href="http://github.com/twardoch/">twardoch</a>
    </p>
  </div>
</div>


    <!-- Wrap is the content to shift when toggling the sidebar. We wrap the
         content to avoid any CSS collisions with our real content. -->
    <div class="wrap">

          <header class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/test-fonts/" title="Home">Test fonts</a>
            <small><a href="http://github.com/twardoch/test-fonts/">twardoch/test-fonts</a></small>
          </h3>
        </div>
      </header>
      

      <article class="container content">
        <div class="page">
  <ol class="breadcrumb">
<li><a href="/test-fonts/">Home</a></li>




    
    
    
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    
    
    
    
        
    
        
    
        
    
        
    
        
    
        
        
            <li class="active">
                
                <a href="/test-fonts/varia/160413-EvenOddTT/">EvenOddTT</a>
            </li>
        
    
        
    
        
    

</ol>

  
  <h1 id="evenoddtt">EvenOddTT</h1>

<p>Example font for testing of the Mac OS X 10.11.4 and macOS 10.12.1 rendering of TrueType-flavored fonts with overlapping contours.</p>

<p><em>Prepared 2016-04-13 by Adam Twardoch, updated 2016-10-31, licensed under <a href="https://creativecommons.org/publicdomain/zero/1.0/">CC0 / Public Domain Dedication</a></em></p>

<h3 id="non-zero-winding-vs-even-odd-winding-truetype-glyph-rendering">Non-zero-winding vs. even-odd-winding TrueType glyph rendering</h3>

<p>The <a href="https://developer.apple.com/fonts/TrueType-Reference-Manual/RM01/Chap1.html">Apple TrueType spec</a> says:</p>

<p><em>The direction of a glyph’s contours is used to determine which portions of the shape defined by the contours is filled(black) and which portions are unfilled (white). In making this determination, TrueType uses the non-zero winding number rule.</em></p>

<p>and reaffirms that <a href="https://developer.apple.com/fonts/TrueType-Reference-Manual/RM02/Chap2.html#distinguishing">elsewhere</a> with examples.</p>

<p>However, in a <a href="https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6AATIntro.html">chapter about AAT</a>, it is stated:</p>

<p><em>One addition to the ‘glyf’ table is the designation of glyphs with overlapping contours. This is not needed for rendering by TrueType scalers, but is needed when a TrueType font must be converted to a Type 1 Font and rendered on a printer under some Level 2 PostScript implementations. Since the introduction of the original ‘glyf’ format, Level 2 Postscript has been introduced. Some printers that incorporate Level 2 Postscript use an even-odd fill algorithm for Type 1 fonts rather than the non-zero winding number fill that was used in previous PostScript implementations. Therefore, to accurately translate a TrueType font to a Type 1 font for use on the Level 2 printers, glyphs with overlapping contours must be simplified, so it is necessary to know which glyphs have overlapping contours. Glyphs that are not properly flagged will be rendered on these printers with white space holes where the contours overlap. For simple glyphs, you should set bit 6 of the first Outline Flag byte to 1 if the unhinted glyph outline has overlapping contours or if variation controls or hinting controls can ever cause any of the contours to overlap. Otherwise this bit should be set to 0.</em></p>

<p>The bit 6 of the Outline Flag is otherwise mentioned as “reserved” in both the <a href="https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6glyf.html">Apple spec</a> and the <a href="https://www.microsoft.com/typography/otspec/glyf.htm">OpenType spec</a>.</p>

<h3 id="the-evenoddtt-sample-font-and-the-problem-of-mac-os-x-10114">The EvenOddTT sample font and the problem of Mac OS X 10.11.4</h3>

<p>The font <strong>EvenOddTT</strong> is a tiny TrueType-flavored OpenType font which contains one glyph (<code class="highlighter-rouge">O</code>) that is drawn with 3 contours, like so:
<img src="01-glyph.png" alt="01-glyph.png" /></p>

<p>The <code class="highlighter-rouge">-orig.ttf</code> version has just this. I have also created a <code class="highlighter-rouge">-mod.ttf</code> version of the sample font which (I believe) has the bit 6 set to 1 in the affected glyph.</p>

<p>The rendering of the glyph that is drawn in such a way is expected to be:
<img src="02-nonzerowind.png" alt="02-nonzerowind.png" /></p>

<p>and this is how this glyph is rendered in FreeType and in Microsoft Windows, and also, if the special bit has been set, in macOS Sierra.</p>

<p>However, in Mac OS X 10.11.4 El Capitan CoreText renderer, the glyph is rendered “inverted”, as follows:
<img src="03-evenoddwind.png" alt="03-evenoddwind.png" /></p>

<p>which suggests that Mac OS X 10.11.4 may be using the even-odd-winding rule. If the special bit is unset, the same rendering happens in macOS 10.12.1 Sierra.</p>

<p>This is confirmed by comparing how the hinted outline is rendered in FontLab Studio 5 using:
* the Microsoft font rasterizer:
<img src="04-ttms.png" alt="04-ttms.png" />
* the current Apple rasterizer:
<img src="05-ttapple.png" alt="05-ttapple.png" /></p>

<h4 id="attachments">Attachments</h4>

<ul>
  <li><a href="EvenOddTT-orig.ttf">EvenOddTT-orig.ttf</a> has the original glyph outline</li>
  <li><a href="EvenOddTT-mod.ttf">EvenOddTT-mod.ttf</a> has bit 6 of the flags field of the first contour in the <code class="highlighter-rouge">O</code> glyph set to 1 — but it does not seem to have any influence over the Apple rasterizer in Mac OS X 10.11 El Capitan, but it <strong>does</strong> affect macOS Sierra. In MacOS 10.12 Sierra, the situation is different: <em>EvenOddTT-orig.ttf</em> renders as it did (with the overlaps visible as “white”) while <em>EvenOddTT-mod.ttf</em> renders as expected, with the overlaps invisible (except in smaller sizes “ghost lines” being visible).</li>
</ul>

<h3 id="other-places-where-the-inverting-problem-is-seen">Other places where the “inverting” problem is seen</h3>

<h3 id="hoefler-text">Hoefler Text</h3>

<p>The same “inverting” problem occurs not only with my sample font but also with the <strong>Hoefler Text</strong> font v8.0d2e1 which ships with Mac OS X 10.11.4.</p>

<p>In all four styles of Hoefler Text, the glyphs for ĦӨө (U+0126 U+04E8 U+04E9) render with the “inverted” overlaps — when the standard OS X CoreText renderer is used. In Hoefler Black, the glyph for ѐ (U+0450) renders with a “black” counter, which may or may not be related to this problem.
<img src="13-HoeflerText.png" alt="13-HoeflerText.png" /></p>

<p>Here’s the glyph <code class="highlighter-rouge">uni04E8</code> (Ө) from Hoefler Text Regular as rendered in:
* the Microsoft font rasterizer:
<img src="10-ttms.png" alt="10-ttms.png" />
* the current Apple rasterizer:
<img src="11-ttapple.png" alt="11-ttapple.png" />
* the “old” monochrome Apple rasterizer:
<img src="12-ttappleold.png" alt="12-ttappleold.png" /></p>

<p>However, other overlapping glyphs in Hoefler Text do not show the “inverting” problem. They still manifest the other annoying issue i.e. that for composite glyphs made from overlapping components such as <code class="highlighter-rouge">hbar</code>, the Apple font renderer draws a thin visible “halo” around each component:
<img src="15-ghostoverlaps.png" alt="" />
<img src="16-ghostoverlaps1.png" alt="" /></p>

<p>But even if the <code class="highlighter-rouge">hbar</code> glyph is decomposed (i.e. turned into a glyph with overlapping contours), the “inverting” problem does not occur.</p>

<p>It seems that the “inverting” problem is not really just a non-zero vs. even-odd winding. Apple seems to be doing some “smart” (in fact, not so smart) guesses. Compare the three versions of a glyph that only differ in where the leftmost nodes of the rectangular contour are placed (the contour directions are always identical). The black rendering in the corner is the result of the Apple rasterizer:</p>

<p><img src="21-cmp1.png" alt="" />
<img src="22-cmp2.png" alt="" />
<img src="23-cmp3.png" alt="" /></p>

<h3 id="skia">Skia</h3>

<p>The same problem manifests itself in Skia, where the <code class="highlighter-rouge">oslash</code> glyph in the bolder variations has a special contour that is “hidden” inside the stem (and should be rendered “black”, but it ends up being rendered as “white”:
<img src="14-skia.png" alt="14-skia.png" /></p>


</div>

      </article>

      <footer class="footer">
        <div class="container">
          <p>
            &copy; 2017 <a href="http://github.com/twardoch/">twardoch</a>
          </p>
        </div>
      </footer>

    

    </div>

    <label for="sidebar-checkbox" class="sidebar-toggle"></label>

    <script>
      (function(document) {
        var toggle = document.querySelector('.sidebar-toggle');
        var sidebar = document.querySelector('#sidebar');
        var checkbox = document.querySelector('#sidebar-checkbox');

        document.addEventListener('click', function(e) {
          var target = e.target;

          if(!checkbox.checked ||
             sidebar.contains(target) ||
             (target === checkbox || target === toggle)) return;

          checkbox.checked = false;
        }, false);
      })(document);
    </script>
  </body>
</html>
